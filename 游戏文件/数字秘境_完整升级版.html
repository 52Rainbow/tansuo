<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­—ç§˜å¢ƒï¼šç»ˆæç§‘æŠ€è§£è°œä¹‹æ—…</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: #0f0f1a;
            color: #00ff88;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            min-height: 600px;
        }
        
        #game-container {
            width: min(95vw, 1000px);
            height: min(95vh, 750px);
            position: relative;
            background: linear-gradient(135deg, #0a0a12 0%, #1a1a2e 100%);
            border: 2px solid #00ff88;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.4);
        }
        
        /* çŸ©é˜µèƒŒæ™¯æ•ˆæœ */
        #matrix-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.12;
            overflow: hidden;
        }
        
        /* åŠ è½½ç•Œé¢ */
        #splash-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, rgba(15, 15, 26, 0.95) 0%, rgba(10, 10, 18, 0.98) 100%);
            z-index: 100;
            transition: opacity 1s ease;
        }
        
        #title {
            font-size: clamp(1.8em, 4vw, 3em);
            margin-bottom: 30px;
            text-shadow: 0 0 15px #00ff88, 0 0 30px #00ff88;
            letter-spacing: 3px;
            animation: pulse 2s infinite ease-in-out;
            text-align: center;
            padding: 0 20px;
        }
        
        #subtitle {
            font-size: 1.2em;
            margin-bottom: 40px;
            color: #00cc7a;
            text-align: center;
            opacity: 0.8;
        }
        
        @keyframes pulse {
            0%, 100% { 
                transform: scale(1);
                text-shadow: 0 0 15px #00ff88, 0 0 30px #00ff88;
            }
            50% { 
                transform: scale(1.05);
                text-shadow: 0 0 20px #00ff88, 0 0 40px #00ff88, 0 0 60px #00ff88;
            }
        }
        
        .game-btn {
            padding: 15px 30px;
            font-size: 1.2em;
            background: linear-gradient(45deg, #00ff88, #00cc7a);
            color: #0a0a12;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            font-weight: bold;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
        }
        
        .game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.5);
        }
        
        .game-btn:active {
            transform: translateY(0);
        }
        
        .game-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .game-btn:hover::before {
            left: 100%;
        }
        
        /* ä¸»æ¸¸æˆç•Œé¢ */
        #main-interface {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
            background: transparent;
        }
        
        /* é¡¶éƒ¨çŠ¶æ€æ  */
        #status-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%);
            border-bottom: 1px solid rgba(0, 255, 136, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 10;
        }
        
        #progress-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .progress-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: #00ff88;
        }
        
        #controls {
            display: flex;
            gap: 10px;
        }
        
        .control-btn {
            padding: 8px 15px;
            font-size: 0.9em;
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }
        
        /* å·¦ä¾§é¢æ¿ */
        #left-panel {
            position: absolute;
            left: 0;
            top: 60px;
            bottom: 0;
            width: 250px;
            background: linear-gradient(135deg, rgba(15, 15, 26, 0.9) 0%, rgba(10, 10, 18, 0.95) 100%);
            border-right: 1px solid rgba(0, 255, 136, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .panel-tab {
            display: flex;
            background: rgba(0, 255, 136, 0.05);
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            color: #00ff88;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        
        .tab-btn.active {
            background: rgba(0, 255, 136, 0.1);
            border-bottom: 2px solid #00ff88;
        }
        
        .tab-btn:hover {
            background: rgba(0, 255, 136, 0.08);
        }
        
        .panel-content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: none;
        }
        
        .panel-content.active {
            display: block;
        }
        
        /* æˆå°±å¢™æ ·å¼ */
        #achievement-wall {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            padding: 15px;
        }
        
        .achievement-badge {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            overflow: hidden;
        }
        
        .achievement-badge.unlocked {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }
        
        .achievement-badge.locked {
            background: linear-gradient(135deg, #333, #555);
            border-color: #666;
            opacity: 0.6;
        }
        
        .achievement-badge:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .achievement-icon {
            font-size: 2em;
            margin-bottom: 5px;
        }
        
        .achievement-name {
            font-size: 0.7em;
            text-align: center;
            color: #333;
            font-weight: bold;
        }
        
        .achievement-badge.locked .achievement-name {
            color: #999;
        }
        
        /* å‡çº§çš„æˆå°±é¢æ¿ */
        #achievement-panel {
            padding: 0;
        }
        
        #achievement-title {
            font-size: 1.2em;
            color: #00ff88;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 0 10px #00ff88;
        }
        
        .achievement-stats {
            background: rgba(0, 255, 136, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .achievement-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 255, 136, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc7a);
            transition: width 0.5s ease;
        }
        
        /* æ¸¸æˆåœ°å›¾åŒºåŸŸ */
        #game-area {
            position: absolute;
            left: 250px;
            top: 60px;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, rgba(0, 255, 136, 0.03) 0%, rgba(0, 0, 0, 0.1) 100%);
            overflow: hidden;
        }
        
        /* ç½‘ç»œåœ°å›¾ */
        #network-map {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: auto;
            padding: 20px;
        }
        
        .node {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #00ff88;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }
        
        .node:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.6);
        }
        
        .node.unlocked {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2) 0%, rgba(0, 255, 136, 0.1) 100%);
            border-color: #00ff88;
        }
        
        .node.completed {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3) 0%, rgba(255, 215, 0, 0.1) 100%);
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }
        
        .node.locked {
            background: linear-gradient(135deg, rgba(100, 100, 100, 0.2) 0%, rgba(100, 100, 100, 0.1) 100%);
            border-color: #666;
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .node-icon {
            font-size: 1.8em;
            margin-bottom: 2px;
        }
        
        .node-label {
            font-size: 0.7em;
            text-align: center;
            color: #00ff88;
        }
        
        /* è¿æ¥çº¿ */
        .connection {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ff88, transparent);
            transform-origin: left center;
            opacity: 0.6;
            z-index: -1;
        }
        
        .connection.unlocked {
            opacity: 1;
            animation: pulse-line 2s infinite ease-in-out;
        }
        
        @keyframes pulse-line {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        /* å¼¹å‡ºæ¡† */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 255, 136, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(0, 255, 136, 0.3);
            padding-bottom: 15px;
        }
        
        .modal-title {
            font-size: 1.5em;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: #00ff88;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255, 0, 0, 0.2);
            color: #ff4444;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            #game-container {
                width: 100vw;
                height: 100vh;
                border-radius: 0;
            }
            
            #left-panel {
                width: 200px;
            }
            
            #game-area {
                left: 200px;
            }
            
            .achievement-badge {
                width: 80px;
                height: 80px;
            }
            
            .node {
                width: 60px;
                height: 60px;
            }
        }
        
        /* æ–°å¢çš„åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 255, 136, 0.3);
            border-top: 4px solid #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* æˆå°±é€šçŸ¥åŠ¨ç”» */
        .achievement-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.5s ease;
            max-width: 300px;
        }
        
        .achievement-notification.show {
            transform: translateX(0);
        }
        
        .achievement-notification .title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        /* ç²’å­æ•ˆæœ */
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #00ff88;
            border-radius: 50%;
            animation: float 3s infinite ease-in-out;
            opacity: 0.7;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-20px) translateX(10px); }
            50% { transform: translateY(-40px) translateX(-5px); }
            75% { transform: translateY(-20px) translateX(-10px); }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- çŸ©é˜µèƒŒæ™¯æ•ˆæœ -->
        <div id="matrix-background"></div>
        
        <!-- åŠ è½½ç•Œé¢ -->
        <div id="splash-screen">
            <div id="title">æ•°å­—ç§˜å¢ƒ</div>
            <div id="subtitle">ç»ˆæç§‘æŠ€è§£è°œä¹‹æ—…</div>
            <button class="game-btn" onclick="startGame()">ğŸš€ å¼€å§‹å†’é™©</button>
            <button class="game-btn" onclick="showInstructions()">ğŸ“– æ¸¸æˆæŒ‡å—</button>
            <button class="game-btn" onclick="showAchievementWall()">ğŸ† æˆå°±å¢™</button>
        </div>
        
        <!-- ä¸»æ¸¸æˆç•Œé¢ -->
        <div id="main-interface">
            <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
            <div id="status-bar">
                <div id="progress-info">
                    <div class="progress-item">
                        <span>ğŸ¯</span>
                        <span>èŠ‚ç‚¹: <span id="nodes-progress">0/6</span></span>
                    </div>
                    <div class="progress-item">
                        <span>ğŸ”</span>
                        <span>çº¿ç´¢: <span id="clues-progress">0/8</span></span>
                    </div>
                    <div class="progress-item">
                        <span>ğŸ†</span>
                        <span>æˆå°±: <span id="achievements-progress">0/15</span></span>
                    </div>
                </div>
                <div id="controls">
                    <button class="control-btn" onclick="toggleSound()">ğŸ”Š</button>
                    <button class="control-btn" onclick="showStats()">ğŸ“Š</button>
                    <button class="control-btn" onclick="showExportMenu()">ğŸ“¤</button>
                    <button class="control-btn" onclick="showHelp()">â“</button>
                    <button class="control-btn" onclick="returnToMenu()">ğŸ </button>
                </div>
            </div>
            
            <!-- å·¦ä¾§é¢æ¿ -->
            <div id="left-panel">
                <div class="panel-tab">
                    <button class="tab-btn active" onclick="switchTab('achievement')">ğŸ† æˆå°±</button>
                    <button class="tab-btn" onclick="switchTab('clues')">ğŸ” çº¿ç´¢</button>
                    <button class="tab-btn" onclick="switchTab('progress')">ğŸ“ˆ è¿›åº¦</button>
                </div>
                
                <!-- æˆå°±é¢æ¿ -->
                <div id="achievement-panel" class="panel-content active">
                    <div id="achievement-title">ğŸ† æˆå°±ç³»ç»Ÿ</div>
                    <div class="achievement-stats">
                        <div class="achievement-progress">
                            <span>å®Œæˆåº¦</span>
                            <span id="achievement-percentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="achievement-progress-bar"></div>
                        </div>
                    </div>
                    <div id="achievement-wall"></div>
                </div>
                
                <!-- çº¿ç´¢é¢æ¿ -->
                <div id="clues-panel" class="panel-content">
                    <div style="font-size: 1.1em; color: #00ff88; margin-bottom: 15px; text-align: center;">ğŸ” æ”¶é›†çš„çº¿ç´¢</div>
                    <div id="clues-container"></div>
                </div>
                
                <!-- è¿›åº¦é¢æ¿ -->
                <div id="progress-panel" class="panel-content">
                    <div style="font-size: 1.1em; color: #00ff88; margin-bottom: 15px; text-align: center;">ğŸ“ˆ æ¢ç´¢è¿›åº¦</div>
                    <div id="progress-container"></div>
                </div>
            </div>
            
            <!-- æ¸¸æˆåŒºåŸŸ -->
            <div id="game-area">
                <div id="network-map"></div>
            </div>
        </div>
    </div>
    
    <!-- å¼¹å‡ºæ¡† -->
    <div id="node-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">èŠ‚ç‚¹ä¿¡æ¯</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-body"></div>
        </div>
    </div>
    
    <div id="achievement-wall-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ† æˆå°±å¢™</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="achievement-wall-content"></div>
        </div>
    </div>
    
    <div id="instructions-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“– æ¸¸æˆæŒ‡å—</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="instructions-content"></div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            unlockedNodes: ['main-hub'],
            completedNodes: [],
            clues: [],
            achievements: [],
            currentNode: null,
            soundEnabled: true,
            startTime: null,
            lastPlayTime: null
        };

        // å‡çº§çš„æˆå°±æ•°æ®
        const achievementsData = [
            // åŸºç¡€æˆå°±
            {
                id: 'first-step',
                name: 'ç¬¬ä¸€æ­¥',
                description: 'å¼€å§‹ä½ çš„æ•°å­—å†’é™©',
                icon: 'ğŸ‘¶',
                difficulty: 1,
                hidden: false,
                type: 'basic'
            },
            {
                id: 'hub-explorer',
                name: 'ä¸­å¿ƒæ¢çº½æ¢ç´¢è€…',
                description: 'æ¢ç´¢ä¸»èŠ‚ç‚¹å¹¶å®Œæˆç¬¬ä¸€ä¸ªè°œé¢˜',
                icon: 'ğŸŒ',
                difficulty: 1,
                hidden: false,
                type: 'basic'
            },
            {
                id: 'data-miner',
                name: 'æ•°æ®çŸ¿å·¥',
                description: 'æˆåŠŸè§£é”å¹¶æ¢ç´¢æ•°æ®ä¸­å¿ƒèŠ‚ç‚¹',
                icon: 'ğŸ’¾',
                difficulty: 2,
                hidden: false,
                type: 'exploration'
            },
            {
                id: 'security-guru',
                name: 'å®‰å…¨ä¸“å®¶',
                description: 'ç ´è§£ç½‘ç»œå®‰å…¨èŠ‚ç‚¹çš„é˜²æŠ¤ç³»ç»Ÿ',
                icon: 'ğŸ”’',
                difficulty: 2,
                hidden: false,
                type: 'exploration'
            },
            {
                id: 'ai-pioneer',
                name: 'AI å…ˆé©±',
                description: 'è¿›å…¥äººå·¥æ™ºèƒ½èŠ‚ç‚¹çš„æ ¸å¿ƒ',
                icon: 'ğŸ¤–',
                difficulty: 2,
                hidden: false,
                type: 'exploration'
            },
            {
                id: 'crypto-master',
                name: 'å¯†ç å¤§å¸ˆ',
                description: 'å¾æœå¯†ç å­¦èŠ‚ç‚¹çš„æ‰€æœ‰æŒ‘æˆ˜',
                icon: 'âš¡',
                difficulty: 3,
                hidden: false,
                type: 'exploration'
            },
            {
                id: 'quantum-explorer',
                name: 'é‡å­æ¢ç´¢è€…',
                description: 'è§£é”ç¥ç§˜çš„é‡å­è®¡ç®—èŠ‚ç‚¹',
                icon: 'ğŸ”®',
                difficulty: 4,
                hidden: false,
                type: 'exploration'
            },
            
            // æ”¶é›†æˆå°±
            {
                id: 'clue-collector',
                name: 'çº¿ç´¢æ”¶é›†è€…',
                description: 'æ”¶é›†5æ¡é‡è¦çº¿ç´¢',
                icon: 'ğŸ”',
                difficulty: 2,
                hidden: false,
                type: 'collection'
            },
            {
                id: 'master-collector',
                name: 'æ”¶é›†å¤§å¸ˆ',
                description: 'æ”¶é›†æ‰€æœ‰å¯ç”¨çº¿ç´¢',
                icon: 'ğŸ“š',
                difficulty: 3,
                hidden: false,
                type: 'collection'
            },
            
            // æŠ€èƒ½æˆå°±
            {
                id: 'puzzle-solver',
                name: 'è§£è°œä¸“å®¶',
                description: 'è¿ç»­è§£å¼€3ä¸ªè°œé¢˜',
                icon: 'ğŸ§©',
                difficulty: 2,
                hidden: false,
                type: 'skill'
            },
            {
                id: 'speed-runner',
                name: 'æé€Ÿæ¢é™©å®¶',
                description: 'åœ¨30åˆ†é’Ÿå†…å®Œæˆå…¨éƒ¨æ¢ç´¢',
                icon: 'âš¡',
                difficulty: 4,
                hidden: false,
                type: 'skill'
            },
            
            // éšè—æˆå°±
            {
                id: 'night-owl',
                name: 'å¤œçŒ«å­',
                description: 'åœ¨æ·±å¤œæ—¶åˆ†æ¢ç´¢æ•°å­—ä¸–ç•Œ',
                icon: 'ğŸŒ™',
                difficulty: 2,
                hidden: true,
                type: 'special'
            },
            {
                id: 'persistent-explorer',
                name: 'åšæŒä¸æ‡ˆ',
                description: 'è¿ç»­æ¸¸æˆè¶…è¿‡1å°æ—¶',
                icon: 'ğŸ’ª',
                difficulty: 3,
                hidden: true,
                type: 'special'
            },
            {
                id: 'perfect-explorer',
                name: 'å®Œç¾æ¢ç´¢è€…',
                description: 'ä»¥100%å®Œæˆåº¦é€šå…³æ¸¸æˆ',
                icon: 'ğŸ‘‘',
                difficulty: 5,
                hidden: true,
                type: 'master'
            },
            {
                id: 'legend',
                name: 'æ•°å­—ä¼ å¥‡',
                description: 'è·å¾—æ‰€æœ‰å…¶ä»–æˆå°±',
                icon: 'ğŸŒŸ',
                difficulty: 5,
                hidden: true,
                type: 'master'
            }
        ];

        // çº¿ç´¢æ•°æ®
        const cluesData = [
            {
                id: 'hub-clue-1',
                name: 'ç½‘ç»œåŸºç¡€',
                description: 'IP åœ°å€ç”±å››ä¸ª 0-255 çš„æ•°å­—ç»„æˆï¼Œå¦‚ 192.168.1.1',
                icon: 'ğŸŒ'
            },
            {
                id: 'data-clue-1',
                name: 'æ•°æ®å­˜å‚¨',
                description: '1 TB = 1024 GB = 1,099,511,627,776 å­—èŠ‚',
                icon: 'ğŸ’¾'
            },
            {
                id: 'security-clue-1',
                name: 'åŠ å¯†åŸºç¡€',
                description: 'å¯¹ç§°åŠ å¯†ä½¿ç”¨åŒä¸€æŠŠå¯†é’¥åŠ å¯†å’Œè§£å¯†æ•°æ®',
                icon: 'ğŸ”’'
            },
            {
                id: 'ai-clue-1',
                name: 'æœºå™¨å­¦ä¹ ',
                description: 'AI è®­ç»ƒéœ€è¦å¤§é‡æ ‡æ³¨æ•°æ®æ¥æé«˜å‡†ç¡®æ€§',
                icon: 'ğŸ¤–'
            },
            {
                id: 'crypto-clue-1',
                name: 'å“ˆå¸Œå‡½æ•°',
                description: 'SHA-256 ç”Ÿæˆ 64 å­—ç¬¦çš„åå…­è¿›åˆ¶å“ˆå¸Œå€¼',
                icon: 'âš¡'
            },
            {
                id: 'quantum-clue-1',
                name: 'é‡å­å åŠ ',
                description: 'é‡å­æ¯”ç‰¹å¯ä»¥åŒæ—¶å¤„äº0å’Œ1çš„å åŠ çŠ¶æ€',
                icon: 'ğŸ”®'
            },
            {
                id: 'network-clue-1',
                name: 'ç½‘ç»œåè®®',
                description: 'TCP/IP æ˜¯äº’è”ç½‘é€šä¿¡çš„åŸºç¡€åè®®æ ˆ',
                icon: 'ğŸŒ'
            },
            {
                id: 'future-clue-1',
                name: 'æœªæ¥ç§‘æŠ€',
                description: 'é‡å­è®¡ç®—æœºå°†å½»åº•æ”¹å˜å¯†ç å­¦å’Œè®¡ç®—é¢†åŸŸ',
                icon: 'ğŸš€'
            }
        ];

        // æ¢ç´¢èŠ‚ç‚¹æ•°æ®
        const explorationNodesData = {
            'main-hub': [
                {
                    id: 'hub-node-1',
                    title: 'ç³»ç»Ÿæ§åˆ¶å°',
                    description: 'ä¸€ä¸ªé—ªçƒçš„æ§åˆ¶å°æ˜¾ç¤ºç€ç³»ç»ŸçŠ¶æ€ã€‚ä½ æ³¨æ„åˆ°æœ‰ä¸€è¡Œå‡¯æ’’å¯†ç åŠ å¯†çš„æ¶ˆæ¯ã€‚',
                    icon: 'ğŸ’»',
                    action: 'è§£å¯†æ¶ˆæ¯',
                    puzzle: {
                        type: 'caesar',
                        question: 'è§£å¯†è¿™æ¡æ¶ˆæ¯ï¼šGUVF VF N FRPERG ZRFFNTR',
                        answer: 'THIS IS A SECRET MESSAGE',
                        hint: 'å°è¯•å°†æ¯ä¸ªå­—æ¯å‘å‰ç§»åŠ¨13ä½'
                    },
                    reward: {
                        clue: 'hub-clue-1',
                        unlock: ['data-center'],
                        achievement: 'hub-explorer'
                    }
                }
            ],
            'data-center': [
                {
                    id: 'data-node-1',
                    title: 'æ•°æ®åº“æœåŠ¡å™¨',
                    description: 'å·¨å¤§çš„æœåŠ¡å™¨æœºæˆ¿ï¼Œæ•°æ®åœ¨å…‰çº¤ä¸­æµæ·Œã€‚ä½ éœ€è¦è§£è¯»ä¸€ä¸²äºŒè¿›åˆ¶ä»£ç ã€‚',
                    icon: 'ğŸ—„ï¸',
                    action: 'è§£ææ•°æ®',
                    puzzle: {
                        type: 'binary',
                        question: 'å°†äºŒè¿›åˆ¶è½¬æ¢ä¸ºæ–‡æœ¬ï¼š01000100 01000001 01010100 01000001',
                        answer: 'DATA',
                        hint: 'æ¯8ä½äºŒè¿›åˆ¶ä»£è¡¨ä¸€ä¸ªASCIIå­—ç¬¦'
                    },
                    reward: {
                        clue: 'data-clue-1',
                        unlock: ['security-center'],
                        achievement: 'data-miner'
                    }
                }
            ],
            'security-center': [
                {
                    id: 'security-node-1',
                    title: 'é˜²ç«å¢™ç³»ç»Ÿ',
                    description: 'å¤šå±‚å®‰å…¨é˜²æŠ¤ç³»ç»Ÿæ­£åœ¨è¿è¡Œã€‚ä½ éœ€è¦æ‰¾åˆ°æ­£ç¡®çš„ç«¯å£å·ç»„åˆã€‚',
                    icon: 'ğŸ›¡ï¸',
                    action: 'ç ´è§£é˜²æŠ¤',
                    puzzle: {
                        type: 'math',
                        question: 'è®¡ç®—ï¼š2^10 + 2^8 + 2^4 = ?',
                        answer: '1296',
                        hint: 'è¿™æ˜¯è®¡ç®—æœºä¸­å¸¸è§çš„ç«¯å£å·è®¡ç®—'
                    },
                    reward: {
                        clue: 'security-clue-1',
                        unlock: ['ai-center'],
                        achievement: 'security-guru'
                    }
                }
            ],
            'ai-center': [
                {
                    id: 'ai-node-1',
                    title: 'AI æ ¸å¿ƒå¤„ç†å™¨',
                    description: 'äººå·¥æ™ºèƒ½çš„æ ¸å¿ƒæ­£åœ¨é«˜é€Ÿè¿ç®—ã€‚ä½ éœ€è¦å®Œæˆä¸€ä¸ªæ¨¡å¼è¯†åˆ«ä»»åŠ¡ã€‚',
                    icon: 'ğŸ§ ',
                    action: 'æ¿€æ´»AI',
                    puzzle: {
                        type: 'pattern',
                        question: 'æ‰¾å‡ºè§„å¾‹ï¼š2, 4, 8, 16, ?',
                        answer: '32',
                        hint: 'æ¯ä¸ªæ•°å­—éƒ½æ˜¯å‰ä¸€ä¸ªæ•°å­—çš„ä¸¤å€'
                    },
                    reward: {
                        clue: 'ai-clue-1',
                        unlock: ['crypto-center'],
                        achievement: 'ai-pioneer'
                    }
                }
            ],
            'crypto-center': [
                {
                    id: 'crypto-node-1',
                    title: 'åŠ å¯†ç®—æ³•åº“',
                    description: 'å„ç§å¯†ç å­¦ç®—æ³•åœ¨è¿™é‡Œæ±‡èšã€‚ä½ é¢å‰æ˜¯ä¸€ä¸ªå¤æ‚çš„å“ˆå¸ŒæŒ‘æˆ˜ã€‚',
                    icon: 'ğŸ”',
                    action: 'è§£å¯†ç®—æ³•',
                    puzzle: {
                        type: 'hash',
                        question: 'è¿™ä¸ªMD5å€¼å¯¹åº”ä»€ä¹ˆå•è¯ï¼š5d41402abc4b2a76b9719d911017c592',
                        answer: 'hello',
                        hint: 'è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„è‹±æ–‡é—®å€™è¯­'
                    },
                    reward: {
                        clue: 'crypto-clue-1',
                        unlock: ['quantum-center'],
                        achievement: 'crypto-master'
                    }
                }
            ],
            'quantum-center': [
                {
                    id: 'quantum-node-1',
                    title: 'é‡å­è®¡ç®—æ ¸å¿ƒ',
                    description: 'é‡å­æ¯”ç‰¹åœ¨è¿™é‡Œè¿›è¡Œç€è¶…è¶Šç»å…¸ç‰©ç†çš„è®¡ç®—ã€‚è§£å¼€è¿™ä¸ªé‡å­è°œé¢˜ã€‚',
                    icon: 'âš›ï¸',
                    action: 'å¯åŠ¨é‡å­è®¡ç®—',
                    puzzle: {
                        type: 'quantum',
                        question: 'åœ¨é‡å­å åŠ çŠ¶æ€ä¸­ï¼Œä¸€ä¸ªé‡å­æ¯”ç‰¹å¯ä»¥è¡¨ç¤ºå¤šå°‘ç§çŠ¶æ€ï¼Ÿ',
                        answer: '2',
                        hint: 'é‡å­æ¯”ç‰¹å¯ä»¥åŒæ—¶å¤„äº0å’Œ1çŠ¶æ€'
                    },
                    reward: {
                        clue: 'quantum-clue-1',
                        achievement: 'quantum-explorer'
                    }
                }
            ]
        };

        // ç½‘ç»œåœ°å›¾èŠ‚ç‚¹é…ç½®
        const networkNodes = [
            { id: 'main-hub', name: 'ä¸»æ¢çº½', icon: 'ğŸŒ', x: 300, y: 200, connections: ['data-center'] },
            { id: 'data-center', name: 'æ•°æ®ä¸­å¿ƒ', icon: 'ğŸ’¾', x: 150, y: 100, connections: ['security-center'] },
            { id: 'security-center', name: 'å®‰å…¨ä¸­å¿ƒ', icon: 'ğŸ”’', x: 450, y: 100, connections: ['ai-center'] },
            { id: 'ai-center', name: 'AIä¸­å¿ƒ', icon: 'ğŸ¤–', x: 100, y: 300, connections: ['crypto-center'] },
            { id: 'crypto-center', name: 'å¯†ç ä¸­å¿ƒ', icon: 'âš¡', x: 500, y: 300, connections: ['quantum-center'] },
            { id: 'quantum-center', name: 'é‡å­ä¸­å¿ƒ', icon: 'ğŸ”®', x: 300, y: 400, connections: [] }
        ];

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            loadGameState();
            createMatrixBackground();
            updateUI();
            checkAchievement('first-step');
        }

        // åˆ›å»ºçŸ©é˜µèƒŒæ™¯æ•ˆæœ
        function createMatrixBackground() {
            const background = document.getElementById('matrix-background');
            const chars = '01';
            
            for (let i = 0; i < 50; i++) {
                const span = document.createElement('span');
                span.textContent = chars[Math.floor(Math.random() * chars.length)];
                span.style.position = 'absolute';
                span.style.left = Math.random() * 100 + '%';
                span.style.top = Math.random() * 100 + '%';
                span.style.fontSize = Math.random() * 20 + 10 + 'px';
                span.style.color = `rgba(0, 255, 136, ${Math.random() * 0.5 + 0.1})`;
                span.style.animation = `float ${Math.random() * 3 + 2}s infinite ease-in-out`;
                span.style.animationDelay = Math.random() * 2 + 's';
                background.appendChild(span);
                
                // åˆ›å»ºç²’å­æ•ˆæœ
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 3 + 's';
                background.appendChild(particle);
            }
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            document.getElementById('splash-screen').style.display = 'none';
            document.getElementById('main-interface').style.display = 'block';
            
            if (!gameState.startTime) {
                gameState.startTime = Date.now();
                gameState.lastPlayTime = Date.now();
                saveGameState();
            }
            
            initNetworkMap();
            initAchievements();
            updateUI();
            
            // æ£€æŸ¥å¤œçŒ«å­æˆå°±
            const hour = new Date().getHours();
            if (hour >= 22 || hour <= 6) {
                checkAchievement('night-owl');
            }
        }

        // æ˜¾ç¤ºæ¸¸æˆæŒ‡å—
        function showInstructions() {
            const modal = document.getElementById('instructions-modal');
            const content = document.getElementById('instructions-content');
            
            content.innerHTML = `
                <div style="line-height: 1.6;">
                    <h3>ğŸ¯ æ¸¸æˆç›®æ ‡</h3>
                    <p>æ¢ç´¢æ•°å­—ä¸–ç•Œçš„å…­ä¸ªæ ¸å¿ƒèŠ‚ç‚¹ï¼Œè§£å¼€å„ç§ç§‘æŠ€è°œé¢˜ï¼Œæ”¶é›†çº¿ç´¢ï¼Œè·å¾—æˆå°±ã€‚</p>
                    
                    <h3>ğŸ® æ¸¸æˆç©æ³•</h3>
                    <ul>
                        <li><strong>èŠ‚ç‚¹æ¢ç´¢</strong>ï¼šç‚¹å‡»ç½‘ç»œåœ°å›¾ä¸Šçš„èŠ‚ç‚¹è¿›è¡Œæ¢ç´¢</li>
                        <li><strong>è°œé¢˜è§£ç­”</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ç‹¬ç‰¹çš„ç§‘æŠ€è°œé¢˜ç­‰å¾…è§£å†³</li>
                        <li><strong>çº¿ç´¢æ”¶é›†</strong>ï¼šæˆåŠŸè§£è°œåè·å¾—æœ‰ä»·å€¼çš„ç§‘æŠ€çº¿ç´¢</li>
                        <li><strong>æˆå°±ç³»ç»Ÿ</strong>ï¼šå®Œæˆç‰¹å®šä»»åŠ¡è§£é”å„ç§æˆå°±å‹‹ç« </li>
                    </ul>
                    
                    <h3>ğŸ§© è°œé¢˜ç±»å‹</h3>
                    <ul>
                        <li><strong>å‡¯æ’’å¯†ç </strong>ï¼šç»å…¸çš„å­—æ¯æ›¿æ¢åŠ å¯†</li>
                        <li><strong>äºŒè¿›åˆ¶è½¬æ¢</strong>ï¼šå°†äºŒè¿›åˆ¶ä»£ç è½¬æ¢ä¸ºæ–‡æœ¬</li>
                        <li><strong>æ•°å­¦è®¡ç®—</strong>ï¼šè®¡ç®—æœºç§‘å­¦ä¸­çš„æ•°å­¦é—®é¢˜</li>
                        <li><strong>æ¨¡å¼è¯†åˆ«</strong>ï¼šæ‰¾å‡ºæ•°å­—æˆ–ç¬¦å·çš„è§„å¾‹</li>
                        <li><strong>å“ˆå¸Œè§£å¯†</strong>ï¼šç ´è§£å¸¸è§çš„å“ˆå¸Œå€¼</li>
                        <li><strong>é‡å­è®¡ç®—</strong>ï¼šé‡å­ç‰©ç†ç›¸å…³çš„æ¦‚å¿µé¢˜</li>
                    </ul>
                    
                    <h3>ğŸ† æˆå°±ç³»ç»Ÿ</h3>
                    <p>æ¸¸æˆåŒ…å«15ä¸ªæˆå°±ï¼Œåˆ†ä¸ºä¸åŒç±»å‹ï¼š</p>
                    <ul>
                        <li><strong>åŸºç¡€æˆå°±</strong>ï¼šå®ŒæˆåŸºæœ¬æ¸¸æˆæµç¨‹</li>
                        <li><strong>æ¢ç´¢æˆå°±</strong>ï¼šè§£é”å¹¶å®Œæˆæ‰€æœ‰èŠ‚ç‚¹</li>
                        <li><strong>æ”¶é›†æˆå°±</strong>ï¼šæ”¶é›†çº¿ç´¢å’Œä¿¡æ¯</li>
                        <li><strong>æŠ€èƒ½æˆå°±</strong>ï¼šå±•ç¤ºè§£è°œæŠ€å·§</li>
                        <li><strong>éšè—æˆå°±</strong>ï¼šç‰¹æ®Šæ¡ä»¶è§¦å‘</li>
                        <li><strong>å¤§å¸ˆæˆå°±</strong>ï¼šç»ˆææŒ‘æˆ˜</li>
                    </ul>
                    
                    <h3>ğŸ’¡ æ¸¸æˆæç¤º</h3>
                    <ul>
                        <li>ä»”ç»†é˜…è¯»æ¯ä¸ªèŠ‚ç‚¹çš„æè¿°ï¼Œå…¶ä¸­åŒ…å«è§£è°œçº¿ç´¢</li>
                        <li>å¦‚æœé‡åˆ°å›°éš¾ï¼Œå¯ä»¥æŸ¥çœ‹è°œé¢˜æç¤º</li>
                        <li>æ”¶é›†çš„çº¿ç´¢ä¼šå¸®åŠ©ä½ ç†è§£ç§‘æŠ€æ¦‚å¿µ</li>
                        <li>å°è¯•åœ¨ä¸åŒæ—¶é—´æ¸¸æˆå¯èƒ½è§¦å‘éšè—æˆå°±</li>
                        <li>è¿½æ±‚100%å®Œæˆåº¦ä»¥è·å¾—æœ€é«˜è£èª‰</li>
                    </ul>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        // æ˜¾ç¤ºæˆå°±å¢™
        function showAchievementWall() {
            const modal = document.getElementById('achievement-wall-modal');
            const content = document.getElementById('achievement-wall-content');
            
            content.innerHTML = '<div id="full-achievement-wall"></div>';
            renderFullAchievementWall();
            
            modal.style.display = 'flex';
        }

        // æ¸²æŸ“å®Œæ•´æˆå°±å¢™
        function renderFullAchievementWall() {
            const container = document.getElementById('full-achievement-wall');
            if (!container) return;
            
            container.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3>ğŸ† æˆå°±æ”¶è—å¢™</h3>
                    <p>è·å¾—æˆå°±ï¼š${gameState.achievements.length}/${achievementsData.length}</p>
                    <div class="progress-bar" style="margin: 10px auto; width: 300px;">
                        <div class="progress-fill" style="width: ${(gameState.achievements.length / achievementsData.length * 100)}%"></div>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; padding: 20px;">
                    ${achievementsData.map(achievement => {
                        const isUnlocked = gameState.achievements.includes(achievement.id);
                        const difficultyStars = 'â­'.repeat(achievement.difficulty);
                        
                        return `
                            <div class="achievement-badge ${isUnlocked ? 'unlocked' : 'locked'}" 
                                 style="width: 120px; height: 140px; border-radius: 10px; padding: 15px;"
                                 title="${achievement.description}">
                                <div class="achievement-icon" style="font-size: 2.5em;">${achievement.icon}</div>
                                <div class="achievement-name" style="font-size: 0.8em; margin-top: 10px;">${achievement.name}</div>
                                <div style="font-size: 0.7em; margin-top: 5px; ${isUnlocked ? 'color: #333;' : 'color: #999;'}">${difficultyStars}</div>
                                ${!isUnlocked && achievement.hidden ? 
                                    '<div style="font-size: 0.6em; color: #666; margin-top: 5px;">éšè—æˆå°±</div>' : ''}
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // åˆå§‹åŒ–ç½‘ç»œåœ°å›¾
        function initNetworkMap() {
            const mapContainer = document.getElementById('network-map');
            mapContainer.innerHTML = '';
            
            // åˆ›å»ºè¿æ¥çº¿
            networkNodes.forEach(node => {
                node.connections.forEach(targetId => {
                    const target = networkNodes.find(n => n.id === targetId);
                    if (target) {
                        createConnection(node, target);
                    }
                });
            });
            
            // åˆ›å»ºèŠ‚ç‚¹
            networkNodes.forEach(node => {
                createNode(node);
            });
        }

        // åˆ›å»ºèŠ‚ç‚¹
        function createNode(nodeData) {
            const node = document.createElement('div');
            node.className = 'node';
            node.id = nodeData.id;
            node.style.left = nodeData.x + 'px';
            node.style.top = nodeData.y + 'px';
            
            const isUnlocked = gameState.unlockedNodes.includes(nodeData.id);
            const isCompleted = gameState.completedNodes.includes(nodeData.id);
            
            if (isCompleted) {
                node.classList.add('completed');
            } else if (isUnlocked) {
                node.classList.add('unlocked');
            } else {
                node.classList.add('locked');
            }
            
            node.innerHTML = `
                <div class="node-icon">${nodeData.icon}</div>
                <div class="node-label">${nodeData.name}</div>
            `;
            
            if (isUnlocked) {
                node.addEventListener('click', () => openNode(nodeData.id));
            }
            
            document.getElementById('network-map').appendChild(node);
        }

        // åˆ›å»ºè¿æ¥çº¿
        function createConnection(fromNode, toNode) {
            const connection = document.createElement('div');
            connection.className = 'connection';
            
            const dx = toNode.x - fromNode.x;
            const dy = toNode.y - fromNode.y;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            connection.style.left = (fromNode.x + 40) + 'px';
            connection.style.top = (fromNode.y + 40) + 'px';
            connection.style.width = length + 'px';
            connection.style.transform = `rotate(${angle}deg)`;
            
            if (gameState.unlockedNodes.includes(toNode.id)) {
                connection.classList.add('unlocked');
            }
            
            document.getElementById('network-map').appendChild(connection);
        }

        // æ‰“å¼€èŠ‚ç‚¹
        function openNode(nodeId) {
            if (!gameState.unlockedNodes.includes(nodeId)) return;
            
            const nodeData = networkNodes.find(n => n.id === nodeId);
            const explorationData = explorationNodesData[nodeId];
            
            if (!explorationData || explorationData.length === 0) {
                showMessage('è¿™ä¸ªèŠ‚ç‚¹æš‚æ—¶æ²¡æœ‰å¯æ¢ç´¢çš„å†…å®¹ã€‚', 'info');
                return;
            }
            
            gameState.currentNode = nodeId;
            const exploration = explorationData[0]; // ç®€åŒ–ï¼šæ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªæ¢ç´¢ç‚¹
            
            const modal = document.getElementById('node-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');
            
            title.textContent = `${nodeData.icon} ${exploration.title}`;
            
            body.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <p style="color: #00ff88; line-height: 1.6;">${exploration.description}</p>
                </div>
                <div style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h4 style="color: #00ff88; margin-bottom: 10px;">ğŸ§© ${exploration.puzzle.type.toUpperCase()} è°œé¢˜</h4>
                    <p style="margin-bottom: 15px;">${exploration.puzzle.question}</p>
                    <input type="text" id="puzzle-answer" placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ..." 
                           style="width: 100%; padding: 10px; background: #1a1a2e; border: 1px solid #00ff88; 
                                  border-radius: 5px; color: #00ff88; font-family: inherit;">
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="game-btn" onclick="checkPuzzleAnswer('${exploration.id}')">æäº¤ç­”æ¡ˆ</button>
                        <button class="game-btn" onclick="showHint('${exploration.puzzle.hint}')">ğŸ’¡ æç¤º</button>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
            document.getElementById('puzzle-answer').focus();
            
            // æ”¯æŒå›è½¦é”®æäº¤
            document.getElementById('puzzle-answer').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkPuzzleAnswer(exploration.id);
                }
            });
        }

        // æ£€æŸ¥è°œé¢˜ç­”æ¡ˆ
        function checkPuzzleAnswer(explorationId) {
            const answer = document.getElementById('puzzle-answer').value.trim().toUpperCase();
            const currentNodeData = explorationNodesData[gameState.currentNode];
            const exploration = currentNodeData.find(e => e.id === explorationId);
            
            if (!exploration) return;
            
            if (answer === exploration.puzzle.answer.toUpperCase()) {
                // ç­”æ¡ˆæ­£ç¡®
                showMessage('ğŸ‰ æ­å–œï¼ç­”æ¡ˆæ­£ç¡®ï¼', 'success');
                
                // ç»™äºˆå¥–åŠ±
                if (exploration.reward.clue) {
                    addClue(exploration.reward.clue);
                }
                
                if (exploration.reward.unlock) {
                    exploration.reward.unlock.forEach(nodeId => {
                        if (!gameState.unlockedNodes.includes(nodeId)) {
                            gameState.unlockedNodes.push(nodeId);
                            showMessage(`ğŸŒŸ æ–°èŠ‚ç‚¹å·²è§£é”ï¼š${networkNodes.find(n => n.id === nodeId)?.name}`, 'info');
                        }
                    });
                }
                
                if (exploration.reward.achievement) {
                    checkAchievement(exploration.reward.achievement);
                }
                
                // æ ‡è®°èŠ‚ç‚¹ä¸ºå·²å®Œæˆ
                if (!gameState.completedNodes.includes(gameState.currentNode)) {
                    gameState.completedNodes.push(gameState.currentNode);
                }
                
                // æ£€æŸ¥å…¶ä»–æˆå°±
                checkProgressAchievements();
                
                saveGameState();
                updateUI();
                closeModal();
                initNetworkMap(); // åˆ·æ–°åœ°å›¾
                
            } else {
                showMessage('âŒ ç­”æ¡ˆä¸æ­£ç¡®ï¼Œè¯·å†è¯•ä¸€æ¬¡ã€‚', 'error');
                document.getElementById('puzzle-answer').value = '';
                document.getElementById('puzzle-answer').focus();
            }
        }

        // æ˜¾ç¤ºæç¤º
        function showHint(hint) {
            showMessage(`ğŸ’¡ æç¤ºï¼š${hint}`, 'info');
        }

        // æ£€æŸ¥è¿›åº¦ç›¸å…³æˆå°±
        function checkProgressAchievements() {
            // æ£€æŸ¥çº¿ç´¢æ”¶é›†æˆå°±
            if (gameState.clues.length >= 5) {
                checkAchievement('clue-collector');
            }
            if (gameState.clues.length >= cluesData.length) {
                checkAchievement('master-collector');
            }
            
            // æ£€æŸ¥è§£è°œæˆå°±
            if (gameState.completedNodes.length >= 3) {
                checkAchievement('puzzle-solver');
            }
            
            // æ£€æŸ¥å®Œç¾æ¢ç´¢è€…
            if (gameState.completedNodes.length >= networkNodes.length && 
                gameState.clues.length >= cluesData.length) {
                checkAchievement('perfect-explorer');
            }
            
            // æ£€æŸ¥é€Ÿåº¦æˆå°±
            if (gameState.startTime && gameState.completedNodes.length >= networkNodes.length) {
                const playTime = (Date.now() - gameState.startTime) / 1000 / 60; // åˆ†é’Ÿ
                if (playTime <= 30) {
                    checkAchievement('speed-runner');
                }
            }
            
            // æ£€æŸ¥æŒç»­æ¸¸æˆæˆå°±
            if (gameState.lastPlayTime) {
                const sessionTime = (Date.now() - gameState.lastPlayTime) / 1000 / 60; // åˆ†é’Ÿ
                if (sessionTime >= 60) {
                    checkAchievement('persistent-explorer');
                }
            }
            
            // æ£€æŸ¥ä¼ å¥‡æˆå°±
            const totalAchievements = achievementsData.length;
            if (gameState.achievements.length >= totalAchievements - 1) { // é™¤äº†ä¼ å¥‡æˆå°±æœ¬èº«
                checkAchievement('legend');
            }
        }

        // æ·»åŠ çº¿ç´¢
        function addClue(clueId) {
            if (!gameState.clues.includes(clueId)) {
                gameState.clues.push(clueId);
                const clue = cluesData.find(c => c.id === clueId);
                if (clue) {
                    showMessage(`ğŸ” è·å¾—æ–°çº¿ç´¢ï¼š${clue.name}`, 'info');
                }
            }
        }

        // è§£é”æˆå°±
        function unlockAchievement(achievementId) {
            try {
                if (!gameState.achievements.includes(achievementId)) {
                    gameState.achievements.push(achievementId);
                    const achievement = achievementsData.find(a => a.id === achievementId);
                    if (achievement) {
                        showAchievementNotification(achievement);
                        updateAchievements();
                        saveGameState();
                    }
                }
            } catch (error) {
                console.error('Error unlocking achievement:', error);
            }
        }

        // æ˜¾ç¤ºæˆå°±é€šçŸ¥
        function showAchievementNotification(achievement) {
            const notification = document.createElement('div');
            notification.className = 'achievement-notification';
            notification.innerHTML = `
                <div class="title">ğŸ† æˆå°±è§£é”ï¼</div>
                <div><strong>${achievement.name}</strong></div>
                <div style="font-size: 0.9em; margin-top: 5px;">${achievement.description}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 500);
            }, 3000);
        }

        // æ£€æŸ¥æˆå°±
        function checkAchievement(achievementId) {
            try {
                const achievement = achievementsData.find(a => a.id === achievementId);
                if (!achievement || gameState.achievements.includes(achievementId)) return;
                
                switch(achievementId) {
                    case 'first-step':
                    case 'hub-explorer':
                    case 'data-miner':
                    case 'security-guru':
                    case 'ai-pioneer':
                    case 'crypto-master':
                    case 'quantum-explorer':
                    case 'clue-collector':
                    case 'master-collector':
                    case 'puzzle-solver':
                    case 'night-owl':
                    case 'speed-runner':
                    case 'persistent-explorer':
                    case 'perfect-explorer':
                    case 'legend':
                        unlockAchievement(achievementId);
                        break;
                }
            } catch (error) {
                console.error('Error checking achievement:', error);
            }
        }

        // åˆå§‹åŒ–æˆå°±ç³»ç»Ÿ
        function initAchievements() {
            try {
                updateAchievements();
                if (gameState.clues.length === 0 && gameState.achievements.length === 0) {
                    checkAchievement('first-step');
                }
            } catch (error) {
                console.error('Error initializing achievements:', error);
            }
        }

        // æ›´æ–°æˆå°±æ˜¾ç¤º
        function updateAchievements() {
            try {
                const achievementWall = document.getElementById('achievement-wall');
                if (!achievementWall) return;
                
                achievementWall.innerHTML = '';
                
                // åªæ˜¾ç¤ºå‰8ä¸ªæˆå°±ä»¥é€‚åº”é¢æ¿å¤§å°
                const visibleAchievements = achievementsData.slice(0, 8);
                
                visibleAchievements.forEach(achievement => {
                    const achieved = gameState.achievements.includes(achievement.id);
                    
                    const badge = document.createElement('div');
                    badge.className = `achievement-badge ${achieved ? 'unlocked' : 'locked'}`;
                    badge.title = `${achievement.name}\n${achievement.description}`;
                    
                    badge.innerHTML = `
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-name">${achievement.name}</div>
                    `;
                    
                    achievementWall.appendChild(badge);
                });
                
                // æ›´æ–°æˆå°±è¿›åº¦
                const percentage = Math.round((gameState.achievements.length / achievementsData.length) * 100);
                const percentageElement = document.getElementById('achievement-percentage');
                const progressBar = document.getElementById('achievement-progress-bar');
                
                if (percentageElement) percentageElement.textContent = percentage + '%';
                if (progressBar) progressBar.style.width = percentage + '%';
                
            } catch (error) {
                console.error('Error updating achievements:', error);
            }
        }

        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°è¿›åº¦ä¿¡æ¯
            document.getElementById('nodes-progress').textContent = 
                `${gameState.completedNodes.length}/${networkNodes.length}`;
            document.getElementById('clues-progress').textContent = 
                `${gameState.clues.length}/${cluesData.length}`;
            document.getElementById('achievements-progress').textContent = 
                `${gameState.achievements.length}/${achievementsData.length}`;
            
            // æ›´æ–°çº¿ç´¢é¢æ¿
            updateCluesPanel();
            
            // æ›´æ–°è¿›åº¦é¢æ¿
            updateProgressPanel();
            
            // æ›´æ–°æˆå°±
            updateAchievements();
        }

        // æ›´æ–°çº¿ç´¢é¢æ¿
        function updateCluesPanel() {
            const container = document.getElementById('clues-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (gameState.clues.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center;">æš‚æ— æ”¶é›†åˆ°çš„çº¿ç´¢</p>';
                return;
            }
            
            gameState.clues.forEach(clueId => {
                const clue = cluesData.find(c => c.id === clueId);
                if (clue) {
                    const clueElement = document.createElement('div');
                    clueElement.style.cssText = `
                        background: rgba(0, 255, 136, 0.1);
                        padding: 10px;
                        margin-bottom: 10px;
                        border-radius: 5px;
                        border-left: 3px solid #00ff88;
                    `;
                    
                    clueElement.innerHTML = `
                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                            <span style="font-size: 1.2em; margin-right: 8px;">${clue.icon}</span>
                            <strong style="color: #00ff88;">${clue.name}</strong>
                        </div>
                        <p style="margin: 0; font-size: 0.9em; color: #ccc;">${clue.description}</p>
                    `;
                    
                    container.appendChild(clueElement);
                }
            });
        }

        // æ›´æ–°è¿›åº¦é¢æ¿
        function updateProgressPanel() {
            const container = document.getElementById('progress-container');
            if (!container) return;
            
            container.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #00ff88; margin-bottom: 10px;">ğŸ“ èŠ‚ç‚¹æ¢ç´¢</h4>
                    ${networkNodes.map(node => {
                        const isUnlocked = gameState.unlockedNodes.includes(node.id);
                        const isCompleted = gameState.completedNodes.includes(node.id);
                        let status = 'ğŸ”’ æœªè§£é”';
                        let color = '#666';
                        
                        if (isCompleted) {
                            status = 'âœ… å·²å®Œæˆ';
                            color = '#ffd700';
                        } else if (isUnlocked) {
                            status = 'ğŸ”“ å·²è§£é”';
                            color = '#00ff88';
                        }
                        
                        return `
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>${node.icon} ${node.name}</span>
                                <span style="color: ${color}; font-size: 0.8em;">${status}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                <div>
                    <h4 style="color: #00ff88; margin-bottom: 10px;">ğŸ¯ æ¸¸æˆç»Ÿè®¡</h4>
                    <div style="font-size: 0.9em; line-height: 1.5;">
                        <div>æ€»æ¸¸æˆæ—¶é—´: ${getGameTimeString()}</div>
                        <div>è§£é”èŠ‚ç‚¹: ${gameState.unlockedNodes.length}/${networkNodes.length}</div>
                        <div>å®ŒæˆèŠ‚ç‚¹: ${gameState.completedNodes.length}/${networkNodes.length}</div>
                        <div>æ”¶é›†çº¿ç´¢: ${gameState.clues.length}/${cluesData.length}</div>
                        <div>è·å¾—æˆå°±: ${gameState.achievements.length}/${achievementsData.length}</div>
                        <div>å®Œæˆåº¦: ${Math.round(((gameState.completedNodes.length + gameState.clues.length + gameState.achievements.length) / (networkNodes.length + cluesData.length + achievementsData.length)) * 100)}%</div>
                    </div>
                </div>
            `;
        }

        // è·å–æ¸¸æˆæ—¶é—´å­—ç¬¦ä¸²
        function getGameTimeString() {
            if (!gameState.startTime) return '0åˆ†é’Ÿ';
            
            const totalMinutes = Math.floor((Date.now() - gameState.startTime) / 1000 / 60);
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            
            if (hours > 0) {
                return `${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
            } else {
                return `${minutes}åˆ†é’Ÿ`;
            }
        }

        // åˆ‡æ¢é¢æ¿æ ‡ç­¾
        function switchTab(tabName) {
            // æ›´æ–°æ ‡ç­¾æŒ‰é’®
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // æ›´æ–°é¢æ¿å†…å®¹
            document.querySelectorAll('.panel-content').forEach(panel => panel.classList.remove('active'));
            document.getElementById(`${tabName}-panel`).classList.add('active');
        }

        // åˆ‡æ¢å£°éŸ³
        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            const btn = event.target;
            btn.textContent = gameState.soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            saveGameState();
        }

        // æ˜¾ç¤ºç»Ÿè®¡
        function showStats() {
            const totalNodes = networkNodes.length;
            const completedNodes = gameState.completedNodes.length;
            const totalClues = cluesData.length;
            const collectedClues = gameState.clues.length;
            const totalAchievements = achievementsData.length;
            const unlockedAchievements = gameState.achievements.length;
            
            const completionRate = Math.round(((completedNodes + collectedClues + unlockedAchievements) / 
                                             (totalNodes + totalClues + totalAchievements)) * 100);
            
            showMessage(`
                ğŸ“Š æ¸¸æˆç»Ÿè®¡\n
                èŠ‚ç‚¹å®Œæˆ: ${completedNodes}/${totalNodes}\n
                çº¿ç´¢æ”¶é›†: ${collectedClues}/${totalClues}\n
                æˆå°±è§£é”: ${unlockedAchievements}/${totalAchievements}\n
                æ€»å®Œæˆåº¦: ${completionRate}%\n
                æ¸¸æˆæ—¶é—´: ${getGameTimeString()}
            `, 'info');
        }

        // æ˜¾ç¤ºå¸®åŠ©
        function showHelp() {
            showMessage(`
                â“ æ¸¸æˆå¸®åŠ©\n
                â€¢ ç‚¹å‡»è§£é”çš„èŠ‚ç‚¹è¿›è¡Œæ¢ç´¢\n
                â€¢ è§£ç­”è°œé¢˜ä»¥è·å¾—å¥–åŠ±\n
                â€¢ æ”¶é›†çº¿ç´¢äº†è§£ç§‘æŠ€çŸ¥è¯†\n
                â€¢ å®ŒæˆæŒ‘æˆ˜è§£é”æˆå°±\n
                â€¢ ç‚¹å‡»ğŸ’¡è·å–è°œé¢˜æç¤º
            `, 'info');
        }

        // è¿”å›ä¸»èœå•
        function returnToMenu() {
            gameState.lastPlayTime = Date.now();
            saveGameState();
            document.getElementById('main-interface').style.display = 'none';
            document.getElementById('splash-screen').style.display = 'flex';
        }

        // å…³é—­å¼¹å‡ºæ¡†
        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type = 'info') {
            const colors = {
                info: '#00ff88',
                success: '#00ff88',
                error: '#ff4444',
                warning: '#ffaa00'
            };
            
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%);
                color: ${colors[type]};
                padding: 20px;
                border-radius: 8px;
                border: 2px solid ${colors[type]};
                z-index: 2000;
                max-width: 400px;
                text-align: center;
                box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
                white-space: pre-line;
            `;
            
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 3000);
        }

        // ä¿å­˜æ¸¸æˆçŠ¶æ€
        function saveGameState() {
            try {
                localStorage.setItem('digitalRealm_gameState', JSON.stringify(gameState));
            } catch (error) {
                console.error('Error saving game state:', error);
            }
        }

        // åŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            try {
                const saved = localStorage.getItem('digitalRealm_gameState');
                if (saved) {
                    const loadedState = JSON.parse(saved);
                    gameState = { ...gameState, ...loadedState };
                }
            } catch (error) {
                console.error('Error loading game state:', error);
            }
        }

        // ç‚¹å‡»å¤–éƒ¨å…³é—­å¼¹å‡ºæ¡†
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                closeModal();
            }
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆæ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initGame);

        // é¡µé¢å¸è½½æ—¶ä¿å­˜çŠ¶æ€
        window.addEventListener('beforeunload', () => {
            if (gameState.lastPlayTime) {
                gameState.lastPlayTime = Date.now();
                saveGameState();
            }
        });

        // ========== æˆå°±å¢™å¯¼å‡ºåŠŸèƒ½ ==========
        
        // æˆå°±å¢™å¯¼å‡ºåŠŸèƒ½
        function exportAchievementWall() {
            // åˆ›å»ºcanvaså…ƒç´ 
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // è®¾ç½®ç”»å¸ƒå¤§å°
            canvas.width = 800;
            canvas.height = 600;
            
            // è®¾ç½®èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#0a0a12');
            gradient.addColorStop(1, '#1a1a2e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // æ·»åŠ è¾¹æ¡†
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 3;
            ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
            
            // æ ‡é¢˜
            ctx.fillStyle = '#00ff88';
            ctx.font = 'bold 28px "Courier New", monospace';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ† æ•°å­—ç§˜å¢ƒ - æˆå°±å¢™', canvas.width / 2, 60);
            
            // å‰¯æ ‡é¢˜
            ctx.font = '16px "Courier New", monospace';
            ctx.fillStyle = '#00cc7a';
            const achievementCount = gameState.achievements.length;
            const totalAchievements = achievementsData.length;
            const percentage = Math.round((achievementCount / totalAchievements) * 100);
            ctx.fillText(`å®Œæˆåº¦: ${achievementCount}/${totalAchievements} (${percentage}%)`, canvas.width / 2, 90);
            
            // ç»˜åˆ¶æˆå°±æ ¼å­
            const gridCols = 5;
            const gridRows = 3;
            const achievementSize = 80;
            const spacing = 20;
            const startX = (canvas.width - (gridCols * achievementSize + (gridCols - 1) * spacing)) / 2;
            const startY = 120;
            
            let achievementIndex = 0;
            
            for (let row = 0; row < gridRows; row++) {
                for (let col = 0; col < gridCols; col++) {
                    if (achievementIndex >= achievementsData.length) break;
                    
                    const achievement = achievementsData[achievementIndex];
                    const isUnlocked = gameState.achievements.includes(achievement.id);
                    
                    const x = startX + col * (achievementSize + spacing);
                    const y = startY + row * (achievementSize + spacing);
                    
                    // ç»˜åˆ¶æˆå°±èƒŒæ™¯
                    ctx.save();
                    if (isUnlocked) {
                        // å·²è§£é” - é‡‘è‰²æ¸å˜
                        const badgeGradient = ctx.createRadialGradient(x + achievementSize/2, y + achievementSize/2, 0, 
                                                             x + achievementSize/2, y + achievementSize/2, achievementSize/2);
                        badgeGradient.addColorStop(0, '#ffd700');
                        badgeGradient.addColorStop(1, '#ffed4e');
                        ctx.fillStyle = badgeGradient;
                        ctx.strokeStyle = '#ffd700';
                    } else {
                        // æœªè§£é” - ç°è‰²
                        const badgeGradient = ctx.createRadialGradient(x + achievementSize/2, y + achievementSize/2, 0, 
                                                             x + achievementSize/2, y + achievementSize/2, achievementSize/2);
                        badgeGradient.addColorStop(0, '#444');
                        badgeGradient.addColorStop(1, '#222');
                        ctx.fillStyle = badgeGradient;
                        ctx.strokeStyle = '#666';
                    }
                    
                    // ç»˜åˆ¶åœ†å½¢èƒŒæ™¯
                    ctx.beginPath();
                    ctx.arc(x + achievementSize/2, y + achievementSize/2, achievementSize/2 - 5, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    // ç»˜åˆ¶æˆå°±å›¾æ ‡
                    ctx.font = '24px "Courier New", monospace';
                    ctx.fillStyle = isUnlocked ? '#333' : '#999';
                    ctx.textAlign = 'center';
                    ctx.fillText(achievement.icon, x + achievementSize/2, y + achievementSize/2 + 8);
                    
                    // ç»˜åˆ¶éš¾åº¦æ˜Ÿçº§
                    const stars = 'â­'.repeat(achievement.difficulty);
                    ctx.font = '8px "Courier New", monospace';
                    ctx.fillText(stars, x + achievementSize/2, y + achievementSize - 8);
                    
                    ctx.restore();
                    achievementIndex++;
                }
            }
            
            // æ·»åŠ åº•éƒ¨ä¿¡æ¯
            ctx.fillStyle = '#00ff88';
            ctx.font = '12px "Courier New", monospace';
            ctx.textAlign = 'center';
            ctx.fillText('æ•°å­—ç§˜å¢ƒ - ç»ˆæç§‘æŠ€è§£è°œä¹‹æ—…', canvas.width / 2, canvas.height - 40);
            ctx.fillText(`å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString()}`, canvas.width / 2, canvas.height - 20);
            
            return canvas;
        }

        // ä¸‹è½½æˆå°±å¢™å›¾ç‰‡
        function downloadAchievementWall() {
            try {
                const canvas = exportAchievementWall();
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const link = document.createElement('a');
                link.download = `æ•°å­—ç§˜å¢ƒ_æˆå°±å¢™_${new Date().toISOString().split('T')[0]}.png`;
                link.href = canvas.toDataURL('image/png');
                
                // è§¦å‘ä¸‹è½½
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showMessage('ğŸ‰ æˆå°±å¢™å¯¼å‡ºæˆåŠŸï¼', 'success');
            } catch (error) {
                console.error('Export error:', error);
                showMessage('âŒ å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }

        // åˆ†äº«æˆå°±å¢™ï¼ˆç”Ÿæˆåˆ†äº«æ–‡æœ¬ï¼‰
        function shareAchievementWall() {
            const achievementCount = gameState.achievements.length;
            const totalAchievements = achievementsData.length;
            const percentage = Math.round((achievementCount / totalAchievements) * 100);
            
            // ç”Ÿæˆæˆå°±emojiç½‘æ ¼
            let achievementGrid = '';
            const gridCols = 5;
            
            for (let i = 0; i < achievementsData.length; i++) {
                if (i > 0 && i % gridCols === 0) {
                    achievementGrid += '\n';
                }
                
                const achievement = achievementsData[i];
                const isUnlocked = gameState.achievements.includes(achievement.id);
                achievementGrid += isUnlocked ? achievement.icon : 'ğŸ”’';
            }
            
            const shareText = `ğŸ† æˆ‘åœ¨ã€Šæ•°å­—ç§˜å¢ƒã€‹ä¸­çš„æˆå°±å¢™ï¼
            
å®Œæˆåº¦: ${achievementCount}/${totalAchievements} (${percentage}%)

${achievementGrid}

ğŸ® æ•°å­—ç§˜å¢ƒ - ç»ˆæç§‘æŠ€è§£è°œä¹‹æ—…
âš¡ æ¢ç´¢æ•°å­—ä¸–ç•Œï¼ŒæŒ‘æˆ˜ç§‘æŠ€è°œé¢˜ï¼`;

            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareText).then(() => {
                    showMessage('ğŸ“‹ æˆå°±å¢™æ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                }).catch(() => {
                    showShareModal(shareText);
                });
            } else {
                showShareModal(shareText);
            }
        }

        // æ˜¾ç¤ºåˆ†äº«æ¨¡æ€æ¡†
        function showShareModal(shareText) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">ğŸ“¤ åˆ†äº«æˆå°±å¢™</h2>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div>
                        <p>å¤åˆ¶ä»¥ä¸‹æ–‡æœ¬åˆ†äº«ä½ çš„æˆå°±ï¼š</p>
                        <textarea style="width: 100%; height: 200px; background: #1a1a2e; color: #00ff88; border: 1px solid #00ff88; border-radius: 5px; padding: 10px; font-family: 'Courier New', monospace;" readonly>${shareText}</textarea>
                        <div style="margin-top: 15px; text-align: center;">
                            <button class="game-btn" onclick="
                                this.closest('.modal').querySelector('textarea').select();
                                document.execCommand('copy');
                                showMessage('ğŸ“‹ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                                this.closest('.modal').remove();
                            ">ğŸ“‹ å¤åˆ¶æ–‡æœ¬</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // å¯¼å‡ºè¯¦ç»†æˆå°±æŠ¥å‘Š
        function exportAchievementReport() {
            const achievementCount = gameState.achievements.length;
            const totalAchievements = achievementsData.length;
            const percentage = Math.round((achievementCount / totalAchievements) * 100);
            
            let report = `# æ•°å­—ç§˜å¢ƒ - ä¸ªäººæˆå°±æŠ¥å‘Š

## ğŸ“Š æ€»ä½“ç»Ÿè®¡
- **å®Œæˆåº¦**: ${achievementCount}/${totalAchievements} (${percentage}%)
- **æ¸¸æˆæ—¶é—´**: ${getGameTimeString()}
- **å¯¼å‡ºæ—¶é—´**: ${new Date().toLocaleString()}

## ğŸ† å·²è·å¾—æˆå°±

`;

            // æŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤ºæˆå°±
            const achievementsByType = {
                'basic': [],
                'exploration': [],
                'collection': [],
                'skill': [],
                'special': [],
                'master': []
            };
            
            gameState.achievements.forEach(achievementId => {
                const achievement = achievementsData.find(a => a.id === achievementId);
                if (achievement) {
                    const type = achievement.type || 'basic';
                    achievementsByType[type].push(achievement);
                }
            });
            
            const typeNames = {
                'basic': 'åŸºç¡€æˆå°±',
                'exploration': 'æ¢ç´¢æˆå°±',
                'collection': 'æ”¶é›†æˆå°±',
                'skill': 'æŠ€èƒ½æˆå°±',
                'special': 'ç‰¹æ®Šæˆå°±',
                'master': 'å¤§å¸ˆæˆå°±'
            };
            
            Object.keys(typeNames).forEach(type => {
                if (achievementsByType[type].length > 0) {
                    report += `### ${typeNames[type]}\n\n`;
                    achievementsByType[type].forEach(achievement => {
                        const stars = 'â­'.repeat(achievement.difficulty);
                        report += `- **${achievement.icon} ${achievement.name}** ${stars}\n  ${achievement.description}\n\n`;
                    });
                }
            });
            
            // æœªè·å¾—çš„æˆå°±
            const unlockedAchievements = achievementsData.filter(a => !gameState.achievements.includes(a.id));
            if (unlockedAchievements.length > 0) {
                report += `## ğŸ”’ å¾…è§£é”æˆå°±\n\n`;
                unlockedAchievements.forEach(achievement => {
                    if (!achievement.hidden) {
                        const stars = 'â­'.repeat(achievement.difficulty);
                        report += `- **${achievement.icon} ${achievement.name}** ${stars}\n  ${achievement.description}\n\n`;
                    }
                });
                
                const hiddenCount = unlockedAchievements.filter(a => a.hidden).length;
                if (hiddenCount > 0) {
                    report += `### éšè—æˆå°±\nè¿˜æœ‰ ${hiddenCount} ä¸ªéšè—æˆå°±ç­‰å¾…å‘ç°...\n\n`;
                }
            }
            
            report += `## ğŸ“ˆ æ¸¸æˆè¿›åº¦

### èŠ‚ç‚¹æ¢ç´¢
- **å·²è§£é”**: ${gameState.unlockedNodes.length}/${networkNodes.length}
- **å·²å®Œæˆ**: ${gameState.completedNodes.length}/${networkNodes.length}

### çº¿ç´¢æ”¶é›†
- **å·²æ”¶é›†**: ${gameState.clues.length}/${cluesData.length}

---
*ç”±æ•°å­—ç§˜å¢ƒæ¸¸æˆè‡ªåŠ¨ç”Ÿæˆ*`;
            
            // ä¸‹è½½æŠ¥å‘Š
            const blob = new Blob([report], { type: 'text/markdown;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `æ•°å­—ç§˜å¢ƒ_æˆå°±æŠ¥å‘Š_${new Date().toISOString().split('T')[0]}.md`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showMessage('ğŸ“ æˆå°±æŠ¥å‘Šå¯¼å‡ºæˆåŠŸï¼', 'success');
        }

        // æ˜¾ç¤ºå¯¼å‡ºèœå•
        function showExportMenu() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">ğŸ“¤ å¯¼å‡ºæˆå°±å¢™</h2>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div>
                        <p>é€‰æ‹©å¯¼å‡ºæ–¹å¼ï¼š</p>
                        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;">
                            <button class="game-btn" onclick="downloadAchievementWall(); this.closest('.modal').remove();">
                                ğŸ–¼ï¸ å¯¼å‡ºä¸ºå›¾ç‰‡
                            </button>
                            <button class="game-btn" onclick="shareAchievementWall(); this.closest('.modal').remove();">
                                ğŸ“± åˆ†äº«æ–‡æœ¬æ ¼å¼
                            </button>
                            <button class="game-btn" onclick="exportAchievementReport(); this.closest('.modal').remove();">
                                ğŸ“ å¯¼å‡ºè¯¦ç»†æŠ¥å‘Š
                            </button>
                        </div>
                        <p style="font-size: 0.9em; color: #666; margin-top: 20px;">
                            ğŸ’¡ æç¤ºï¼šå›¾ç‰‡æ ¼å¼é€‚åˆä¿å­˜çºªå¿µï¼Œæ–‡æœ¬æ ¼å¼é€‚åˆç¤¾äº¤åˆ†äº«ï¼Œè¯¦ç»†æŠ¥å‘ŠåŒ…å«å®Œæ•´æ¸¸æˆç»Ÿè®¡ã€‚
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>